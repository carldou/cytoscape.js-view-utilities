<!DOCTYPE>

<html>

	<head>
		<title>cytoscape-view-utilities.js demo</title>

		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
		<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

		<!-- for testing with local version of cytoscape.js -->
		<!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cose-bilkent/2.0.4/cytoscape-cose-bilkent.js"></script>
    <script src="lib/cytoscape-undo-redo.js"></script>


		<script src="cytoscape-view-utilities.js"></script>

		<style>
			body {
				font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
				font-size: 14px;
			}

			#cy {
				width: 80%;
				height: 100%;
				left: 21%;
				top: 0%;
				float: left;
				overflow: hidden;
				position: fixed;
			}
			.topnav {
				width: 20%;
				background-color: #e9e9e9;
				font-weight: bold;
				border-color: black;
				border-style: solid;
				font-size: 16;
			}
			.topnav b:hover
			{
				 background-color:white;
			}
			/* Customize the label (the container) */
			.topnav .container {

				position: relative;
				padding: 14px;
				cursor: pointer;
				font-size: 15px;
				left: 5px;
				-webkit-user-select: none;
				-moz-user-select: none;          'border-color': 'purple'
				-ms-user-select: none;
				user-select: none;
			}
			/* Hide the browser's default radio button */
			.topnav .container input {
				position: absolute;
				opacity: 0;
				cursor: pointer;
				height: 0;
				width: 0;
			}
			/* Create a custom radio button */
			.topnav .checkmark {
				position: absolute;
				top: 17px;
				left: 0;
				right: 0px;
				height: 12px;
				width: 12px;
				margin-right: 20px;
				background-color: #000000;
				border-radius: 50%;
			}
			/* On mouse-over, add a grey background color */
			.container:hover input ~ .checkmark {
				background-color: #000000;
			}
			/* When the radio button is checked, add a blue background */
			.container input:checked ~ .checkmark {
				background-color: #000          'border-color': 'purple'000;
			}
			/* Create the indicator (the dot/circle - hidden when not checked) */
			.checkmark:after {
				content: "";
				position: absolute;
				display: none;
			}
			/* Show the indicator (dot/circle) when checked */
			.container input:checked ~ .checkmark:after {
				display: block;
			}
			/* Style the indicator (dot/circle) */
			.container .checkmark:after {
				position: absolute;
				top: 3px;
				left: 3px;
				width: 6px;
				height: 6px;
				border-radius: 50%;
				background: white;
			}
		</style>

		<script>

			document.addEventListener("DOMContentLoaded", function(){

                var cy = window.cy = cytoscape({
                    container: document.getElementById('cy'),
                    layout: { name: "cose-bilkent" },
										style: [
											{
													selector: 'node',
													style: {
															'content': 'data(name)',
															'border-color': 'grey',
															'border-width': 3,
															'background-color': 'lightgrey'
													}
											},
											{
													selector: 'edge',
													style: {
															'target-arrow-shape': 'triangle'
													}
											},
											{
												selector: 'edge:selected',
												style: {
														'line-color': 'black'
												}
											},
											{
												selector: 'node:selected',
												style: {
														'border-color': 'black',
														'border-width': '3px',
														'background-color': 'lightgrey'
												}
											},
											{
												selector: 'node:parent',
												style: {
														'background-color': 'lightgrey'
												}
											}
										],

                    elements: {
                        nodes: [
                            { data: { id: 'n1', name: 'n1' } },
                            { data: { id: 'n2', name: 'n2', parent: "n1"} },
                            { data: { id: 'n3', name: 'n3', parent: "n1" } },
                            { data: { id: 'n4', name: 'n4', parent: "n1" } },
                            { data: { id: 'n5', name: 'n5' } },
                            { data: { id: 'n6', name: 'n6' } },
                            { data: { id: 'n7', name: 'n7' } },
                            { data: { id: 'n8', name: 'n8' } },
                            { data: { id: 'n9', name: 'n9' } },
                            { data: { id: 'n10', name: 'n10' } },
                            { data: { id: 'n11', name: 'n11' } },
                            { data: { id: 'n12', name: 'n12' } },
                            { data: { id: 'n13', name: 'n13' } },
                            { data: { id: 'n14', name: 'n14' } },
                            { data: { id: 'n15', name: 'n15' } },
                            { data: { id: 'n16', name: 'n16' } },
                            { data: { id: 'n17', name: 'n17' } },
                            { data: { id: 'n18', name: 'n18' } },
                            { data: { id: 'n19', name: 'n19' } },
                            { data: { id: 'n20', name: 'n20' } },
                            { data: { id: 'n21', name: 'n21' } },
                        ],
                        edges: [
                            { data: { source: 'n2', target: 'n3' } },
                            { data: { source: 'n4', target: 'n3' } },
                            { data: { source: "n3", target: "n5" } },
                            { data: { source: "n5", target: "n6" } },
                            { data: { source: 'n5', target: 'n7' } },
                            { data: { source: 'n6', target: 'n7' } },
                            { data: { source: "n7", target: "n8" } },
                            { data: { source: "n8", target: "n9" } },
                            { data: { source: 'n7', target: 'n10' } },
                            { data: { source: 'n6', target: 'n11' } },
                            { data: { source: "n7", target: "n11" } },
                            { data: { source: "n9", target: "n10" } },
                            { data: { source: 'n10', target: 'n11' } },
                            { data: { source: 'n10', target: 'n12' } },
                            { data: { source: "n12", target: "n13" } },
                            { data: { source: "n12", target: "n14" } },
                            { data: { source: "n12", target: "n15" } },
                            { data: { source: "n13", target: "n15" } },
                            { data: { source: 'n15', target: 'n16' } },
                            { data: { source: 'n15', target: 'n17' } },
                            { data: { source: "n15", target: "n18" } },
                            { data: { source: "n17", target: "n19" } },
                            { data: { source: 'n17', target: 'n20' } },
                            { data: { source: 'n19', target: 'n20' } },
                            { data: { source: "n19", target: "n21" } }
                        ]
                    }
                });

                var api = cy.viewUtilities({
                    neighbor: function(node){
                        return node.closedNeighborhood();
                    },
                    neighborSelectTime: 1000
                });

                var ur = cy.undoRedo();

                // Increase border width to show nodes with hidden neighbors
                function thickenBorder(eles){
                  eles.forEach(function( ele ){
                    var defaultBorderWidth = Number(ele.css("border-width").substring(0,ele.css("border-width").length-2));
                    ele.css("border-width", defaultBorderWidth + 2);
                  });
                  eles.data("thickBorder", true);
                  return eles;
                }
                // Decrease border width when hidden neighbors of the nodes become visible
                function thinBorder(eles){
                  eles.forEach(function( ele ){
                    var defaultBorderWidth = Number(ele.css("border-width").substring(0,ele.css("border-width").length-2));
                    ele.css("border-width", defaultBorderWidth - 2);
                  });
                  eles.removeData("thickBorder");
                  return eles;
                }

                ur.action("thickenBorder", thickenBorder, thinBorder);
                ur.action("thinBorder", thinBorder, thickenBorder);

                //In below functions, finding the nodes to hide/show are sample specific.
                //If the sample graph changes, those calculations may also need a change.

                $("#hide").click(function (){
                    var actions = [];
                    var nodesToHide = cy.$(":selected").add(cy.$(":selected").nodes().descendants());
                    var nodesWithHiddenNeighbor = cy.edges(":hidden").connectedNodes().intersection(nodesToHide);
                    actions.push({name: "thinBorder", param: nodesWithHiddenNeighbor});
                    actions.push({name: "hide", param: nodesToHide});
                    nodesWithHiddenNeighbor = nodesToHide.neighborhood(":visible")
                        .nodes().difference(nodesToHide).difference(cy.nodes("[thickBorder]"));
                    actions.push({name: "thickenBorder", param: nodesWithHiddenNeighbor});
                    cy.undoRedo().do("batch", actions);
                });

                $("#showAll").click(function () {
                    var actions = [];
                    var nodesWithHiddenNeighbor = cy.nodes("[thickBorder]");
                    actions.push({name: "thinBorder", param: nodesWithHiddenNeighbor});
                    actions.push({name: "show", param: cy.elements()});
                    ur.do("batch", actions);
                });

                $("#showHiddenNeighbors").click(function () {
                    var hiddenEles = cy.$(":selected").neighborhood().filter(':hidden');
                    var actions = [];
                    var nodesWithHiddenNeighbor = (hiddenEles.neighborhood(":visible").nodes("[thickBorder]"))
                        .difference(cy.edges(":hidden").difference(hiddenEles.edges().union(hiddenEles.nodes().connectedEdges())).connectedNodes());
                    actions.push({name: "thinBorder", param: nodesWithHiddenNeighbor});
                    actions.push({name: "show", param: hiddenEles.union(hiddenEles.parent())});
                    nodesWithHiddenNeighbor = hiddenEles.nodes().edgesWith(cy.nodes(":hidden").difference(hiddenEles.nodes()))
                        .connectedNodes().intersection(hiddenEles.nodes());
                    actions.push({name: "thickenBorder", param: nodesWithHiddenNeighbor});
                    cy.undoRedo().do("batch", actions);
                });

                var tappedBefore;

                cy.on('tap', 'node', function (event) {
                  var node = this;

                  var tappedNow = node;
                  setTimeout(function () {
                    tappedBefore = null;
                  }, 300);
                  if (tappedBefore && tappedBefore.id() === tappedNow.id()) {
                    tappedNow.trigger('doubleTap');
                    tappedBefore = null;
                  } else {
                    tappedBefore = tappedNow;
                  }
                });

                cy.on('doubleTap', 'node', function (event) {
                    var hiddenEles = cy.$(":selected").neighborhood().filter(':hidden');
                    var actions = [];
                    var nodesWithHiddenNeighbor = (hiddenEles.neighborhood(":visible").nodes("[thickBorder]"))
                        .difference(cy.edges(":hidden").difference(hiddenEles.edges().union(hiddenEles.nodes().connectedEdges())).connectedNodes());
                    actions.push({name: "thinBorder", param: nodesWithHiddenNeighbor});
                    actions.push({name: "show", param: hiddenEles.union(hiddenEles.parent())});
                    nodesWithHiddenNeighbor = hiddenEles.nodes().edgesWith(cy.nodes(":hidden").difference(hiddenEles.nodes()))
                        .connectedNodes().intersection(hiddenEles.nodes());
                    actions.push({name: "thickenBorder", param: nodesWithHiddenNeighbor});
                    cy.undoRedo().do("batch", actions);
                });

								function chooseHighlightColor(){
									var option = "";
									if(document.getElementById('highlight1').checked)
									{
										option = "highlighted";
									}
									else if(document.getElementById('highlight2').checked)
									{
										option = "highlighted2";
									}
									else if(document.getElementById('highlight3').checked)
									{
										option = "highlighted3";
									}
									else if(document.getElementById('highlight4').checked)
									{
										option = "highlighted4";
									}
                  return option;
                }

                $("#highlightNeighbors").click(function () {
										if(cy.$(":selected").length > 0)
										{
											var option = chooseHighlightColor();
											ur.do("highlightNeighbors", cy.$(":selected"), option);
										}
                });

								$("#highlightElements").click(function () {
                    if(cy.$(":selected").length > 0)
										{
											var option = chooseHighlightColor();
                      ur.do("highlight", cy.$(":selected"), option);
										}
                });

								$("#removeSelectedHighlights").click(function () {
										if(cy.$(":selected").length > 0)
                    	ur.do("removeHighlights", cy.$(":selected"));
                });

                $("#removeAllHighlights").click(function () {
                    ur.do("removeHighlights");
                });

                $("#search").click(function () {
                    var text = $("#toSearch").val();
                    cy.elements().search(text).highlightNeighbors();
                });

                document.addEventListener("keydown", function (e) {
                    if (e.ctrlKey){
                        if (e.which === 90)
                            ur.undo();
                        else if (e.which === 89)
                            ur.redo();
                    }
                });
			});
		</script>
	</head>

	<body>
		<h1>cytoscape.js-view-utilities demo</h1>


				<div class="topnav">
						<b id="hide" style="cursor: pointer; color: darkmagenta">Hide Selected</b> / <b id="showAll" style="cursor: pointer; color: darkmagenta">Show All</b> <br/><br/>
						<b id="highlightColor">Choose Highlight Color:</b> <br/><br/>
						<label class="container"  style="color: #0B9BCD">Blue
						  <input type="radio" name="radiobutton" id="highlight1" value="highlight1">
						  <span class="checkmark"></span>
						</label> <br/><br/>
						<label class="container" style="color: green">Green
						  <input type="radio" name="radiobutton" id="highlight2" value="highlight2">
						  <span class="checkmark"></span>
						</label>  <br/><br/>
						<label class="container" style="color: #F8C200">Yellow
						  <input type="radio" name="radiobutton" id="highlight3" value="highlight3">
						  <span class="checkmark"></span>
						</label> <br/><br/>
						<label class="container" style="color: #BF0603">Red
						  <input type="radio" name="radiobutton" id="highlight4" value="highlight4">
						  <span class="checkmark"></span>
						</label> <br/><br/>
						<b id="highlightElements" style="cursor: pointer; color: darkmagenta">Highlight Elements</b> <br/><br/>
						<b id="highlightNeighbors" style="cursor: pointer; color: darkmagenta">Highlight Neighbors</b><br/><br/>
						<b id="showHiddenNeighbors" style="cursor: pointer; color: darkmagenta">Show Hidden Neighbors of Selected</b> <br/><br/>
						<b id="removeSelectedHighlights" style="cursor: pointer; color: darkmagenta">Remove Selected Highlights</b> <br/><br/>
						<b id="removeAllHighlights" style="cursor: pointer; color: darkmagenta">Remove All Highlights</b> <br/><br/>
						<b id="zoomToSelected" style="cursor: pointer; color: darkmagenta">Zoom to Selected</b><br/><br/>
						<b id="marqueeZoom" style="cursor: pointer; color: darkmagenta">Marquee Zoom</b><br/><br/>
						<b>Shift + drag</b> to specify region<br/>
						<b>Shift + taphold</b> to select neighbors<br/>
						<b>CTRL+Z</b> to undo, <b>CTRL+Y</b> to redo<br/>
						<label for="layout" style="vertical-align:middle;">Rearrange on Hide/Show</label>
						<input type="checkbox" id="layout" name="layout" style="vertical-align:middle;" value="checked"><br>
				</div>

        <div id="cy"></div>

	</body>

</html>
